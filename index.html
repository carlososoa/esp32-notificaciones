<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Alertas de Seguridad - ESP32</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Íconos de Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
        }
        .notificacion {
            animation: fadeIn 0.6s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <div class="text-center mb-4">
            <h1 class="display-5 text-danger"><i class="bi bi-exclamation-triangle-fill"></i> Alertas por Hurto</h1>
            <p class="lead">Recibiendo notificaciones en tiempo real desde sensores ESP32</p>
        </div>

        <div id="notificaciones" class="row g-3">
            <!-- Aquí se insertan las notificaciones -->
        </div>
    </div>



    <audio id="sonido-alerta" src="siren-wail-ringtone.mp3" preload="auto"></audio>

    <script>
        const socket = io();

        socket.on('nueva-notificacion', (data) => {


            // ▶️ Reproducir sonido
            const sonido = document.getElementById('sonido-alerta');
            sonido.currentTime = 0; // Reinicia por si se activa muchas veces rápido
            sonido.play();
            
            const container = document.getElementById('notificaciones');

            // Formatear fecha
            const fechaOriginal = new Date(data.mensaje.FechaHora); // Asegúrate de que este campo existe
            const opciones = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute:'2-digit', second:'2-digit' };
            const fechaFormateada = fechaOriginal.toLocaleString('es-CO', opciones);

            const col = document.createElement('div');
            col.className = 'col-md-6';

            const card = document.createElement('div');
            card.className = 'card shadow notificacion border-danger';

            const cardBody = document.createElement('div');
            cardBody.className = 'card-body';

            const titulo = document.createElement('h5');
            titulo.className = 'card-title text-danger';
            titulo.innerHTML = `<i class="bi bi-shop-window"></i> ${data.mensaje.NombreNegocio}`;

            const direccion = document.createElement('p');
            direccion.className = 'card-text mb-1';
            direccion.innerHTML = `<i class="bi bi-geo-alt-fill"></i> ${data.mensaje.Direccion}`;

            const fecha = document.createElement('p');
            fecha.className = 'card-text text-muted mb-2';
            fecha.innerHTML = `<i class="bi bi-clock-fill"></i> ${fechaFormateada}`;

            const enlace = document.createElement('a');
            enlace.href = `https://www.google.com/maps/search/?api=1&query=${data.mensaje.Coordenadas[0]},${data.mensaje.Coordenadas[1]}&hl=es-419`;
            enlace.target = '_blank';
            enlace.className = 'btn btn-sm btn-outline-danger mt-2';
            enlace.innerHTML = '<i class="bi bi-map"></i> Ver ubicación';

            cardBody.appendChild(titulo);
            cardBody.appendChild(direccion);
            cardBody.appendChild(fecha);
            cardBody.appendChild(enlace);

            card.appendChild(cardBody);
            col.appendChild(card);
            container.prepend(col); // Última alerta arriba
        });
    </script>
</body>
</html>
